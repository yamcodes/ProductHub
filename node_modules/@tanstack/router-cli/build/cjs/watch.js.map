{"version":3,"file":"watch.js","sources":["../../src/watch.ts"],"sourcesContent":["import chokidar from 'chokidar'\nimport path from 'path'\nimport { getConfig } from './config'\nimport { generator } from './generator'\n\nexport async function watch() {\n  const configWatcher = chokidar.watch(\n    path.resolve(process.cwd(), 'tsr.config.js'),\n  )\n\n  let watcher = new chokidar.FSWatcher()\n\n  const generatorWatcher = async () => {\n    const config = await getConfig()\n\n    watcher.close()\n\n    console.log(`TSR: Watching routes (${config.routesDirectory})...`)\n    watcher = chokidar.watch(config.routesDirectory)\n\n    watcher.on('ready', async () => {\n      try {\n        await generator(config)\n      } catch (err) {\n        console.error(err)\n        console.log()\n      }\n\n      const handle = async () => {\n        try {\n          await generator(config)\n        } catch (err) {\n          console.error(err)\n          console.log()\n        }\n      }\n\n      watcher.on('change', handle)\n      watcher.on('add', handle)\n      watcher.on('addDir', handle)\n      watcher.on('unlink', handle)\n      watcher.on('unlinkDir', handle)\n    })\n  }\n\n  configWatcher.on('ready', generatorWatcher)\n  configWatcher.on('change', generatorWatcher)\n}\n"],"names":["watch","configWatcher","chokidar","path","resolve","process","cwd","watcher","FSWatcher","generatorWatcher","config","getConfig","close","console","log","routesDirectory","on","generator","err","error","handle"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAKO,eAAeA,KAAK,GAAG;AAC5B,EAAA,MAAMC,aAAa,GAAGC,4BAAQ,CAACF,KAAK,CAClCG,wBAAI,CAACC,OAAO,CAACC,OAAO,CAACC,GAAG,EAAE,EAAE,eAAe,CAAC,CAC7C,CAAA;AAED,EAAA,IAAIC,OAAO,GAAG,IAAIL,4BAAQ,CAACM,SAAS,EAAE,CAAA;EAEtC,MAAMC,gBAAgB,GAAG,YAAY;AACnC,IAAA,MAAMC,QAAM,GAAG,MAAMC,gBAAS,EAAE,CAAA;IAEhCJ,OAAO,CAACK,KAAK,EAAE,CAAA;AAEfC,IAAAA,OAAO,CAACC,GAAG,CAAA,wBAAA,GAA0BJ,QAAM,CAACK,eAAe,GAAO,MAAA,CAAA,CAAA;IAClER,OAAO,GAAGL,4BAAQ,CAACF,KAAK,CAACU,QAAM,CAACK,eAAe,CAAC,CAAA;AAEhDR,IAAAA,OAAO,CAACS,EAAE,CAAC,OAAO,EAAE,YAAY;MAC9B,IAAI;QACF,MAAMC,mBAAS,CAACP,QAAM,CAAC,CAAA;OACxB,CAAC,OAAOQ,GAAG,EAAE;AACZL,QAAAA,OAAO,CAACM,KAAK,CAACD,GAAG,CAAC,CAAA;QAClBL,OAAO,CAACC,GAAG,EAAE,CAAA;AACf,OAAA;MAEA,MAAMM,MAAM,GAAG,YAAY;QACzB,IAAI;UACF,MAAMH,mBAAS,CAACP,QAAM,CAAC,CAAA;SACxB,CAAC,OAAOQ,GAAG,EAAE;AACZL,UAAAA,OAAO,CAACM,KAAK,CAACD,GAAG,CAAC,CAAA;UAClBL,OAAO,CAACC,GAAG,EAAE,CAAA;AACf,SAAA;OACD,CAAA;AAEDP,MAAAA,OAAO,CAACS,EAAE,CAAC,QAAQ,EAAEI,MAAM,CAAC,CAAA;AAC5Bb,MAAAA,OAAO,CAACS,EAAE,CAAC,KAAK,EAAEI,MAAM,CAAC,CAAA;AACzBb,MAAAA,OAAO,CAACS,EAAE,CAAC,QAAQ,EAAEI,MAAM,CAAC,CAAA;AAC5Bb,MAAAA,OAAO,CAACS,EAAE,CAAC,QAAQ,EAAEI,MAAM,CAAC,CAAA;AAC5Bb,MAAAA,OAAO,CAACS,EAAE,CAAC,WAAW,EAAEI,MAAM,CAAC,CAAA;AACjC,KAAC,CAAC,CAAA;GACH,CAAA;AAEDnB,EAAAA,aAAa,CAACe,EAAE,CAAC,OAAO,EAAEP,gBAAgB,CAAC,CAAA;AAC3CR,EAAAA,aAAa,CAACe,EAAE,CAAC,QAAQ,EAAEP,gBAAgB,CAAC,CAAA;AAC9C;;;;"}